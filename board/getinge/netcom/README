U-Boot environment
==================

Common variables
----------------

This is only needed if the U-Boot binary version from Adeneo is used:

  setenv machid E12

With the U-Boot binary built by Buildroot, the machine number is
already properly set.

The MAC address also needs to be set:

  setenv ethaddr xx:yy:zz:aa:bb:cc

For TFTP/NFS booting
--------------------

setenv nfspath NFSPATH
setenv bootargs 'console=ttyS4,115200 root=/dev/nfs nfsroot=SERVERIP:NFSPATH ip=IPADDR mtdparts=atmel_nand:3m(kernel),16m(rootfs)'
setenv bootcmd 'tftp 70000000 uImage; bootm'

For NAND booting
----------------

See board/getinge/netcom/u-boot-env.txt

Note: instead of setting the environment manually, you may want to use
the pre-generated image in output/images/u-boot-env.bin. In this case,
don't forget that the MAC address must also be set separatly.

Reflashing AT91Bootstrap and U-Boot
===================================

Installation
------------

 *) Download and unpack the SAM-BA utility from
    http://www.at91.com/linux4sam/bin/view/Linux4SAM/SoftwareTools

 *) Copy the board/getinge/netcom/isp-extram-at91sam9g45.bin file to
    the tcl_lib/at91sam9g45-ek/ in the SAM-BA installation.

Flashing
--------

 *) Unplug the power from the NetCOM board

 *) Disconnect the Dataflash chipselect jumper

 *) Plug the power and the USB device cable to the NetCOM board

 *) Reconnect the Dataflash chipselect jumper

 *) Create a symbolic link /dev/ttyUSB0 -> /dev/ttyACM0
    sudo ln -s /dev/ttyACM0 /dev/ttyUSB0

    (this is needed because SAM-BA only recognizes ttyUSB* and ttyS*
    while on Linux, the Atmel USB device is recognized as ttyACM*)

 *) Start SAM-BA with the flashing script :

    ./sam-ba /dev/ttyUSB0 at91sam9g45-ekes board/getinge/netcom/samba-script.tcl

Generate a firmware image
=========================

./output/host/usr/bin/fwupgrade-tool -o output/images/fw.img -p kernel:./output/images/uImage -p rootfs:./output/images/rootfs.jffs2 -i 0x2424

Start the upgrade process from the command line
===============================================

curl -F "file=@./output/images/fw.img" http://IPADDR/cgi-bin/fwupgrade-cgi
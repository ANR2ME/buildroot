diff --git a/board/atmel/at91sam9m10g45ek/at91sam9m10g45ek.c b/board/atmel/at91sam9m10g45ek/at91sam9m10g45ek.c
index 5a04274..b35d392 100644
--- a/board/atmel/at91sam9m10g45ek/at91sam9m10g45ek.c
+++ b/board/atmel/at91sam9m10g45ek/at91sam9m10g45ek.c
@@ -92,10 +92,10 @@ static void at91sam9m10g45ek_usb_hw_init(void)
 {
 	struct at91_pmc *pmc = (struct at91_pmc *)ATMEL_BASE_PMC;
 
-	writel(1 << ATMEL_ID_PIODE, &pmc->pcer);
+	writel(1 << ATMEL_ID_PIOB, &pmc->pcer);
 
-	at91_set_gpio_output(AT91_PIN_PD1, 0);
-	at91_set_gpio_output(AT91_PIN_PD3, 0);
+	at91_set_gpio_output(AT91_PIN_PB28, 1);
+	at91_set_gpio_output(AT91_PIN_PB31, 1);
 }
 #endif
 
diff --git a/board/atmel/at91sam9m10g45ek/partition.c b/board/atmel/at91sam9m10g45ek/partition.c
index 4c53560..611cda1 100644
--- a/board/atmel/at91sam9m10g45ek/partition.c
+++ b/board/atmel/at91sam9m10g45ek/partition.c
@@ -31,7 +31,9 @@ struct dataflash_addr cs[CONFIG_SYS_MAX_DATAFLASH_BANKS] = {
 
 /*define the area offsets*/
 dataflash_protect_t area_list[NB_DATAFLASH_AREA] = {
-	{0x00000000, 0x000041FF, FLAG_PROTECT_SET,   0, "Bootstrap"},
-	{0x00004200, 0x000083FF, FLAG_PROTECT_CLEAR, 0, "Environment"},
-	{0x00008400, 0x00041FFF, FLAG_PROTECT_SET,   0, "U-Boot"},
+	{0x00000000, 0x000020FF, FLAG_PROTECT_SET,   0, "Bootstrap"},
+	{0x00002100, 0x000041FF, FLAG_PROTECT_CLEAR, 0, "Environment"},
+	{0x00004200, 0x00037AFF, FLAG_PROTECT_SET,   0, "U-Boot"},
+	{0x00037B00, 0x0003DDFF, FLAG_PROTECT_CLEAR, 0, "Test script"},
+	{0x0003DE00, 0x0003FEFF, FLAG_PROTECT_CLEAR, 0, "Env. backup"},
 };
diff --git a/common/Makefile b/common/Makefile
index 2d9ae8c..5833f62 100644
--- a/common/Makefile
+++ b/common/Makefile
@@ -34,7 +34,7 @@ COBJS-$(CONFIG_SYS_HUSH_PARSER) += hush.o
 COBJS-y += image.o
 COBJS-y += s_record.o
 COBJS-$(CONFIG_SERIAL_MULTI) += serial.o
-COBJS-y += xyzModem.o
+COBJS-$(CONFIG_CMD_LOAD) += xyzModem.o
 
 # core command
 COBJS-y += cmd_boot.o
@@ -107,7 +107,7 @@ COBJS-$(CONFIG_CMD_CRAMFS) += cmd_cramfs.o
 COBJS-$(CONFIG_CMD_LDRINFO) += cmd_ldrinfo.o
 COBJS-$(CONFIG_CMD_LED) += cmd_led.o
 COBJS-$(CONFIG_CMD_LICENSE) += cmd_license.o
-COBJS-y += cmd_load.o
+COBJS-$(CONFIG_CMD_LOAD) += cmd_load.o
 COBJS-$(CONFIG_LOGBUFFER) += cmd_log.o
 COBJS-$(CONFIG_ID_EEPROM) += cmd_mac.o
 COBJS-$(CONFIG_CMD_MD5SUM) += cmd_md5sum.o
@@ -133,7 +133,7 @@ COBJS-$(CONFIG_CMD_OTP) += cmd_otp.o
 ifdef CONFIG_PCI
 COBJS-$(CONFIG_CMD_PCI) += cmd_pci.o
 endif
-COBJS-y += cmd_pcmcia.o
+COBJS-$(CONFIG_CMD_PCMCIA) += cmd_pcmcia.o
 COBJS-$(CONFIG_CMD_PORTIO) += cmd_portio.o
 COBJS-$(CONFIG_CMD_PXE) += cmd_pxe.o
 COBJS-$(CONFIG_CMD_REGINFO) += cmd_reginfo.o
diff --git a/include/configs/at91sam9m10g45ek.h b/include/configs/at91sam9m10g45ek.h
index 2c2efed..9b5693c 100644
--- a/include/configs/at91sam9m10g45ek.h
+++ b/include/configs/at91sam9m10g45ek.h
@@ -71,6 +71,7 @@
 #define ATMEL_PMC_UHP		AT91SAM926x_PMC_UHP
 
 /* LCD */
+#if 0
 #define CONFIG_LCD
 #define LCD_BPP				LCD_COLOR8
 #define CONFIG_LCD_LOGO
@@ -83,6 +84,7 @@
 #define CONFIG_SYS_CONSOLE_IS_IN_ENV
 /* board specific(not enough SRAM) */
 #define CONFIG_AT91SAM9G45_LCD_BASE		0x73E00000
+#endif
 
 /* LED */
 #define CONFIG_AT91_LED
@@ -94,10 +96,12 @@
 /*
  * BOOTP options
  */
+#if 0
 #define CONFIG_BOOTP_BOOTFILESIZE
 #define CONFIG_BOOTP_BOOTPATH
 #define CONFIG_BOOTP_GATEWAY
 #define CONFIG_BOOTP_HOSTNAME
+#endif
 
 /*
  * Command line configuration.
@@ -107,13 +111,17 @@
 #undef CONFIG_CMD_FPGA
 #undef CONFIG_CMD_IMI
 #undef CONFIG_CMD_IMLS
-#undef CONFIG_CMD_AUTOSCRIPT
 #undef CONFIG_CMD_LOADS
+#undef CONFIG_CMD_LOADB
+#undef CONFIG_CMD_DHCP
+#undef CONFIG_CMD_PING
+#undef CONFIG_CMD_XIMG
+#undef CONFIG_CMD_NFS
 
-#define CONFIG_CMD_PING
-#define CONFIG_CMD_DHCP
 #define CONFIG_CMD_NAND
 #define CONFIG_CMD_USB
+#define CONFIG_CMD_FAT
+#define CONFIG_CMD_SOURCE
 
 /* SDRAM */
 #define CONFIG_NR_DRAM_BANKS		1
@@ -176,10 +184,10 @@
 #ifdef CONFIG_SYS_USE_DATAFLASH_CS0
 /* bootstrap + u-boot + env in dataflash */
 #define CONFIG_ENV_IS_IN_DATAFLASH
-#define CONFIG_SYS_MONITOR_BASE (CONFIG_SYS_DATAFLASH_LOGIC_ADDR_CS0 + 0x8400)
-#define CONFIG_ENV_OFFSET 0x4200
-#define CONFIG_ENV_ADDR (CONFIG_SYS_DATAFLASH_LOGIC_ADDR_CS0 + CONFIG_ENV_OFFSET)
-#define CONFIG_ENV_SIZE 0x4200
+#define CONFIG_SYS_MONITOR_BASE (CONFIG_SYS_DATAFLASH_LOGIC_ADDR_CS0 + 0x4200)
+#define CONFIG_ENV_OFFSET       0x2100
+#define CONFIG_ENV_ADDR         (CONFIG_SYS_DATAFLASH_LOGIC_ADDR_CS0 + CONFIG_ENV_OFFSET)
+#define CONFIG_ENV_SIZE         0x2100
 #else
 /* bootstrap + u-boot + env in nandflash */
 #define CONFIG_ENV_IS_IN_NAND
@@ -206,7 +214,7 @@
 #define CONFIG_SYS_CBSIZE		256
 #define CONFIG_SYS_MAXARGS		16
 #define CONFIG_SYS_PBSIZE		(CONFIG_SYS_CBSIZE + sizeof(CONFIG_SYS_PROMPT) + 16)
-#define CONFIG_SYS_LONGHELP
+//#define CONFIG_SYS_LONGHELP
 #define CONFIG_CMDLINE_EDITING
 #define CONFIG_AUTO_COMPLETE
 #define CONFIG_SYS_HUSH_PARSER
